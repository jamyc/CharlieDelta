pool:
  vmImage: ubuntu-latest

variables: 
  azureSubscription: Visual Studio Professional
  resourceGroupName: rg-cloudengineer
  resourceGroupLocation: westeurope

steps:
# No official BicepTemplateDeployment task yet. We're using az cli to deploy the bicep templates, as recommended by Alex Frankel: https://github.com/Azure/bicep/issues/1341#issuecomment-802010110.
- task: AzureCLI@2
  displayName: Deploy Bicep Templates
  inputs:
    azureSubscription: $(azureSubscription)
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      echo 'Creating resource group $(resourceGroupName)...'
      az group create --name $(resourceGroupName) --location $(resourceGroupLocation)

      echo 'Deploying Bicep'
      az deployment group create --template-file $(System.DefaultWorkingDirectory)/infra/main.bicep --resource-group $(resourceGroupName)
